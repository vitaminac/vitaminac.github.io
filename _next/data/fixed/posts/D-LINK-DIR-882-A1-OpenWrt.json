{
  "pageProps": {
    "postData": {
      "title": "OpenWrt Installation and Configuration on D-LINK DIR-882-A1",
      "markdownContentSource": "\n## Download OpenWrt Firmware\n\nOpen https://openwrt.org/toh/d-link/dir-882_a1#installation and select *Firmware Install*. At this step we need to download **factory** version.\n\n## Flash OpenWrt Firmware\n\n1. Connect to D-Link router through Ethernet cable.\n2. Power off the router\n3. Hold on the reset key and restart the router, release the reset key until you see the LED starts blinking.\n4. On the computer, manually assign a static IP address on the 192.168.0.xxx subnet, other than 192.168.0.1 (e.g. 192.168.0.2)\n5. Open a web browser and navigate to [http://192.168.0.1](http://192.168.0.1)\n6. Choose the firmware file you have downloaded previously and click on **Upload**.\n7. After the file has been uploaded, you should see a *Device is upgrading the firmware* message on the web browse\n8. The device will reboot automatically after the flashing process finishes\n\n## Configuration through OpenWrt LuCI web interface\n\n* Change to DHCP mode after the router is restarted\n* The gateway by default is http://192.168.1.1 without password\n* System > Administration\n    * change router admin password\n    * SSH Access\n      * modify interface to LAN\n      * change SSH port to other\n    * SSH Keys\n      * past the content of your public key file. It will be a long string starting with `ssh-rsa …`\n* Network > Wireless > 2.4G AP & 5G AP\n  * Device Configuration\n    * Advance Settings: modify country code\n  * Interface Configuration\n    * General Setup: modify ESSID\n    * Wireless Security\n      * Encryption: WPA2-PSK\n      * Cipher: Force CCMP\n      * Key: Your Wi-Fi Password\n    * Advanced Settings\n      * uncheck *Disassociate On Low Acknowledgement*\n      * check *Disable Inactivity Polling*\n      * Time interval for rekeying GTK: 3600\n* Network > Wireless > 5G AP > Device Configuration\n  * Operating frequency\n    * Mode: **AC**\n    * Channel: 36\n    * Width **80mhz**\n* Network > Wireless: Save & Apply\n* Network > Interface\n  1. LAN > General Settings: modify IPv4 address to 192.168.0.1 if 192.168.1.1 as gateway has conflict with upstream\n  1. WAN > Advanced Settings: unchecked **Use DNS servers advertised by peer**\n  1. WAN > Advanced Settings: add and click **+** button for following DNS **1.1.1.1**, **8.8.8.8**, **8.8.4.4** in **Use custom DNS servers**\n  1. Save & Apply\n* Network > Firewall > General Settings\n    1. Routing/NAT Offloading\n        * check **Software flow offloading**\n        * check **Hardware flow offloading**\n    1. Save & Apply\n* Network > DHCP and DNS > Hostnames: add custom binding of domain name to static IP for example blocking a website. You might need to add two versions of mapping, one for IPv4 and one for IPv6.\n  * for blocking the domain it is recommended to use adblock\n\n## Configuration through OpenWrt SSH\n\n### Disabling password authentication\n\n    uci set dropbear.@dropbear[0].PasswordAuth=\"0\"\n    uci set dropbear.@dropbear[0].RootPasswordAuth=\"0\"\n    uci commit dropbear\n    /etc/init.d/dropbear restart\n\n## Obtain PPPoE Username & Password\n\nThe steps to obtain PPPoE will vary per country and operator. I've followed [this tutorial](https://www.frikidelto.com/tutorial/como-conseguir-el-usuario-y-contrasena-pppoe-para-instalar-un-router-neutro/).\n\n## Configure PPPoE\n\n1. Network> Interfaces > Devices: Add device configuration\n    1. Select VLAN (802.1q) as device type\n    2. Select WAN as base device\n    3. Introduce 20 in VLAN ID 20 (This configuration depends on the operator)\n    4. uncheck \"Enable IPv6\"\n    5. Save\n    6. Save & apply\n2. Network> Interfaces > Interface: click edit on WAN configuration\n    1. Change protocol to PPPoE\n    2. Select Software VLAN wan.20 as device\n    3. Introduce PPPoE username and password\n    4. Save\n    5. Save & apply\n\n## Adblock\n\n* System > Software: Update lists\n* System > Software: Search **curl** and install.\n* System > Software: Search `adblock`, `luci-app-adblock` and install.\n* Services > Adblock > Additional Settings > Download Utility: Select **curl**\n* Services > Edit Blacklist: add domain you want to block\n* Services > Adblock: Save & Apply\n\n## Other Utilities\n\n* System > Software: Search *htop* and install.\n\nYou can also access router OS through SSH with `ssh root@192.168.0.1` and install the packages with `opkg` command. It is recommended to not upgrade `luci-*` packages, this package is web interface of router, and it often generates conflict between the new version and old version.\n\n## Upgrade Firmware\n\nGo to https://firmware-selector.openwrt.org/?version=22.03.2&target=ramips%2Fmt7621&id=dlink_dir-882-a1 and add `luci`, `luci-ssl` and any of your packages, in my case are `luci`, `luci-ssl`, `curl`, `adblock`, `luci-app-adblock`, `htop`, click **Request Build**, and download the **sysupgrade** OpenWrt firmware and then enter System > Backup/Flash Firmware to upload the bin file, it is recommended to backup and export the configuration.\n\n## Benchmark\n\n### Wireless Speed Test\n\n#### TX: Device - Wireless - Router\n\nInstall [`iperf3`](https://openwrt.org/packages/pkgdata/iperf3) on OpenWrt and after than run `iperf3 -s`. Then from a client device connected to the network through wireless execute the command `iperf3 -c <IP Address of Your OpenWrt Router> -p <iperf3 Server Port> -f m -t 30 -w 256k -P 4`.\n\n#### TX: Device - Wireless - Router - Ethernet - Device\n\nInstall `iperf3` on another device connected to the network through Ethernet interface and then repeat the same testing again this device. The reason we need to repeat the testing with this configuration is because [your router might not be able to process the packets as consumer efficiently but do switch packet quickly](https://forum.openwrt.org/t/iperf-measure-network-speed/9203/2).\n\n#### RX\n\nRepeat the experiments but reverse the relationship of server and client. You should now run `iperf3 -s` in your device to verify the download speed.\n\n## Map with a Free Domain\n\n### Verify NAT\n\nFirst you need to confirm with your internet provider that your router doesn't live behind a [NAT](https://en.wikipedia.org/wiki/Network_address_translation) or [CGNAT](https://en.wikipedia.org/wiki/Carrier-grade_NAT). You can also manually verify this by checking your IP address when you search in Google and the IP address from OpenWrt GUI -> Network -> Interfaces -> WAN -> IPv4.\n\n### Create Domain\n\nYou can request a free domain with [Duck DNS](https://www.duckdns.org/).\n\n### [Keep the IP Address Up-to-Date](https://www.duckdns.org/install.jsp)\n\n## Expose Internal Service to Internet\n\nFrom OpenWrt Luci GUI -> Network -> DHCP and DNS -> Static Leases, set your internal host with a static IP address so port forwarding can work.\n\nGo to OpenWrt Luci GUI -> Network -> Firewall -> Port Forwards, then add rules to forward traffic from Internet to your internal host which lives inside of private network e.g. port forwarding to SSH server.\n\n## Reference\n\n* [Image formats](https://openwrt.org/docs/techref/image.format)\n* [D-Link Recovery GUI](https://openwrt.org/docs/guide-user/installation/recovery_methods/d-link_recovery_gui)\n* [Canales wifi en la banda 5 GHz en España: Lo que nunca te han contado](https://bandaancha.eu/articulos/canales-wifi-banda-5-ghz-espana-mejor-9826)\n* [Todos los canales y bandas de frecuencias wifi legales en España en 2,4; 5 y 6 GHz](https://bandaancha.eu/articulos/todas-canales-bandas-wifi-2-4-5-6ghz-10117)\n* [¿Es mejor un router wifi si tiene muchas antenas MIMO?](https://bandaancha.eu/articulos/mejor-router-wifi-tiene-muchas-antenas-9810)\n* [When to Use 20mhz vs 40mhz vs 80mhz](https://www.cbtnuggets.com/blog/certifications/cisco/when-to-use-20mhz-vs-40mhz-vs-80mhz)\n* [Wi-Fi Ping Spikes: Causes and Fixes](https://www.smallnetbuilder.com/wireless/wireless-features/33228-wi-fi-ping-spikes-causes-and-fixes)\n* [Different Wi-Fi Protocols and Data Rates](https://www.intel.com/content/www/us/en/support/articles/000005725/wireless/legacy-intel-wireless-products.html)\n* [Edit /etc/hosts via WebUI](https://forum.archive.openwrt.org/viewtopic.php?id=54943)",
      "slug": "D-LINK-DIR-882-A1-OpenWrt",
      "date": "2022-10-30 17:03:37",
      "lang": "en",
      "tags": ["openwrt", "network", "router", "hard router"],
      "path": "/D-LINK-DIR-882-A1-OpenWrt/index.html"
    },
    "lang": "en",
    "_nextI18Next": {
      "initialI18nStore": {
        "en": {
          "common": { "Next": "Next" },
          "feature-tags": { "Tags": "Tags" },
          "navbar": {
            "Home": "Home",
            "Language": "Language",
            "Tags": "Tags",
            "en": "English",
            "es": "Spanish",
            "zh": "Chinese"
          },
          "post-layout": { "Author": "Author: {{author}}" }
        }
      },
      "initialLocale": "en",
      "ns": ["common", "feature-tags", "navbar", "post-layout"],
      "userConfig": {
        "i18n": { "defaultLocale": "en", "locales": ["en", "es", "zh"] },
        "default": {
          "i18n": { "defaultLocale": "en", "locales": ["en", "es", "zh"] }
        }
      }
    }
  },
  "__N_SSG": true
}
