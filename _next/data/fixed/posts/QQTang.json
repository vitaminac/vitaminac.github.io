{
  "pageProps": {
    "postData": {
      "title": "浅谈QQ堂",
      "markdownContentSource": "\n## QQ堂DLL劫持\n\n在QQ堂目录下面有个`zlib1.dll`文件, 我们可以利用之前介绍的技巧制作自己的[zlib1.dll](/downloads/code/QQTang/zlib1.dll)当作我们的外挂程序.\n\n## 修复版本过低和验证码闪退补丁\n\n下载[QQ游戏](https://qqgame.qq.com/download.shtml)客户端, 然后在QQ游戏客户端文件夹里面找[SSOCommon.dll](/downloads/code/QQTang/SSOCommon.dll), [SSOPlatform.dll](/downloads/code/QQTang/SSOPlatform.dll), 或者你也可以直接下载我提取好的. 我们可以在我们的DLL用`LoadLibraryW`加载这两个DLL文件. 修改`zlib1.c`然后重新生成`zlib1.dll`把他和`SSOCommon.dll`, `SSOPlatform.dll`一起复制到QQ堂根目录下面就能解决版本过低和验证码闪退的问题.\n\n## 创建窗口\n\n我们需要创建一个新的进程用来维持一个独立的图形化界面, 具体看代码\n\n{% include_code lang:c from:3 to:220 QQTang/zlib1.c %}\n\n## 下载商城资源\n\nQQ堂的商城资源保存在服务端`http://qqt-img.qq.com/item/ItemZips/<资源类别>/<资源类别><资源id>.zip`. 资源类别和资源id可以在`object/itemCFG.pyc`和`object/commodityCFG.pyc`中找到. 运行我写的脚本[实现](https://gist.github.com/vitaminac/76682c7f9a065566d213bd46c849bdec).\n\n    mkdir -p script\n    git clone https://gist.github.com/76682c7f9a065566d213bd46c849bdec.git script\n    conda create --no-default-packages -n QQT python=3.8.12\n    conda activate QQT\n    conda install aiohttp\n    cd script\n    python QQTResourceDownload.py\n\n### 反编译pyc\n\n安装[uncompyle6](https://github.com/rocky/python-uncompyle6)\n\n    pip install uncompyle6\n\n然后运行`uncompyle6`反编译`pyc`文件\n\n    FOR /R %f IN (*.pyc) DO (uncompyle6 -o . --encoding gbk %f)\n\n`uncompyle6`可能会反编译注释的时候出错因为QQ堂源文件是`gbk`编码的,需要修改一些`uncompyle6`源码,在这[一段](https://github.com/rocky/python-uncompyle6/blob/e2ff9096031ea50fb0fc3a6f3a56c179fbd4ac3b/uncompyle6/semantics/helper.py#L155)之前添加一行`docstring = docstring.decode(\"gbk\")`. 即使反编译出来,源码不一定能直接用,需要手动修改, 需要一些的Python的知识. 例如可能会有编码的问题以及一些在最新版本的Python会出现语法不支持.\n\n## 反编译QQ堂地图编辑器\n\n安装Python2.5然后安装unpy2exe然后把把exe转换成pyc文件.反编译的主要难题是Python2.5版本太老了,安装不了pip文件,需要手动修改pip的源码,很多依赖也要手动安装,要找支持对应Python版本的依赖,有些可能根本没有或者太老了.我猜测QQ堂本身也可以被反编译的,不过可能要安装更老版的Python例如2.2版本.\n\n## 参考\n\n* [火拼QQ堂穿墙功能的挖掘](https://mp.weixin.qq.com/s/DdEpDFn3sen7Jb3rU-K3iA)\n* [对某游戏功能实现的逆向分析及实现变态功能](https://blog.csdn.net/laixicheng/article/details/108062170)\n* [缘来社区 - QQ堂板块](http://www.445e.com/b-28)\n* [网悠社区 - QQ堂板块](http://www.2wyu.com/f13)\n",
      "slug": "QQTang",
      "date": "2021-11-24 14:33:25",
      "lang": "zh",
      "tags": ["QQ堂", "外挂", "Game", "zlib"],
      "path": "/QQTang/index.html"
    },
    "lang": "zh",
    "_nextI18Next": {
      "initialI18nStore": {
        "zh": {
          "common": { "Next": "下一页" },
          "feature-tags": { "Tags": "标签" },
          "navbar": {
            "Home": "主页",
            "Language": "语言",
            "Tags": "标签",
            "en": "英语",
            "es": "西语",
            "zh": "中文"
          },
          "post-layout": { "Author": "作者: {{author}}" }
        },
        "en": {
          "common": { "Next": "Next" },
          "feature-tags": { "Tags": "Tags" },
          "navbar": {
            "Home": "Home",
            "Language": "Language",
            "Tags": "Tags",
            "en": "English",
            "es": "Spanish",
            "zh": "Chinese"
          },
          "post-layout": { "Author": "Author: {{author}}" }
        }
      },
      "initialLocale": "zh",
      "ns": ["common", "feature-tags", "navbar", "post-layout"],
      "userConfig": {
        "i18n": { "defaultLocale": "en", "locales": ["en", "es", "zh"] },
        "default": {
          "i18n": { "defaultLocale": "en", "locales": ["en", "es", "zh"] }
        }
      }
    }
  },
  "__N_SSG": true
}
