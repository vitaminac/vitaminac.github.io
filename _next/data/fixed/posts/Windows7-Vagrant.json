{
  "pageProps": {
    "postData": {
      "slug": "Windows7-Vagrant",
      "title": "How to Create a Windows7 Vagrant Base Box",
      "date": "2022-03-26 11:55:38",
      "lang": "en",
      "tags": ["Vagrant", "winrm"],
      "path": "/Windows7-Vagrant/index.html",
      "markdownContentSource": "\n# How to Create a Windows 7 Vagrant Base Box?\n\n## Introduction\n\nSince Vagrant 1.6 release, Vagrant add support for Windows VMs. We will go through the steps to follow to create a Windows 7 Vagrant base box.\n\n## Pre-requisites\n\n* VirtualBox/VMWare\n* Vagrant 1.6 or above\n* Windows 7 ISO file\n* VirtualBox Guest Additions\n* A valid license key for the version of Windows 7 to be installed\n\n## Create New Virtual Machine\n\nStart VirtualBox and create a new Windows 7 virtual machine. Name it whatever you like, though keep it simple as we will override this name later in Vagrantfile. We will follow most of the advice given in the Vagrant documentation regarding base boxes.\n\n* Disk Space: Choose a virtual hard disk (VDI) dynamically allocated and choose a high upper limit for the size. The default max-size is pretty low (32 GB).\n* Memory: Choose a low value here e.g. 1 GB, the reason is users that use the base box can always increase the memory in their Vagrantfile. I chose 2048 MB, but 1024 MB would do as well.\n* CPU: Leave this at the default of 1. Again this is something users can override in the Vagrantfile, so try not to require a higher number to start with.\n* Disable any unnecessary hardware like audio. Leave 2D/3D acceleration disabled.\n\nThe idea behind these choices is to create your base box as light on resources as possible with as much room as possible for later customization. When creating a new machine in VirtualBox in the wizard a lot of options are auto-configured, so we may need to edit the machine after it is created, going into Settings, to change some options.\n\n* Settings > General > Advanced: Enable Host-to-Guest shared clipboard.\n* Settings > General > System > Motherboard: Disable Floppy boot.\n* Settings > General > Audio: Disable audio.\n\nYou can follow the New Virtual Machine Wizard with Custom (advanced) configuration to create the Windows 7 virtual machine. Select similar options as VirtualBox, although some options might be different.\n\n* Select the version of Windows to install\n* Full name: vagrant\n* Password: vagrant\n* Firmware type: BIOS\n* Network connection: NAT\n* Disk: Store virtual disk as a single file\n\nUsers of your base box can always modify these options in their Vagrantfile, using the [VirtualBox specific configuration](https://www.vagrantup.com/docs/providers/virtualbox/configuration) or [VMWare specific configuration](https://www.vagrantup.com/docs/providers/vmware/configuration).\n\n## Install Windows 7\n\nYou should have your Windows 10 ISO ready at hand, then configure the ISO file to boot from in VirtualBox, skip prompts to enter a license key and this can always be entered later through Control Panel or command line, after this, installation is straight forward.\n\nTowards the end of the installation you will be prompted to sign in your Microsoft account, again skip this. You want to create a local admin account on your clean install named vagrant with password also vagrant. This is required if you want Vagrant to automatically connect to and provision machines on your base box.\n\nLet the Windows setup complete, you will be presented with a login prompt for your user vagrant. Go ahead and login to the Windows 10 desktop. When connecting to the network windows will ask you if the network you are connected to is public or private. Choose private, otherwise you will get issues with **WinRM** in the next step.\n\n## Prepare Windows For Vagrant\n\n* Install VirtualBox Guest Additions/VMware Tools on your base box from the menu.\n* Control Panel > Programs and Features > Turn Windows features on or off.\n* Disable UAC: Control Panel > User Accounts > Change user account control settings, drop the slider to the bottom - Never notify.\n* Turn off System Protection： Control Panel > System > Advanced System Settings > System Protection > Turn off protection.\n* Enable **WinRM** service：Open command prompt as Administrator and paste each line and press enter. The last line configures **WinRM** services to start automatically. This will allow Vagrant to connect to the box and control it. **WinRM** is the alternative to ssh for windows boxes.\n----\n\n    winrm quickconfig -q\n    winrm set winrm/config/winrs @{MaxMemoryPerShellMB=\"512\"}\n    winrm set winrm/config @{MaxTimeoutms=\"1800000\"}\n    winrm set winrm/config/service @{AllowUnencrypted=\"true\"}\n    winrm set winrm/config/service/auth @{Basic=\"true\"}\n    sc config WinRM start= auto\n\n* Relax the Powershell execution policy: Run Powershell as Administrator and execute this command: `Set-ExecutionPolicy -ExecutionPolicy Unrestricted`, choose Yes to any prompts. This will allow Powershell scripts to provision your base box without annoying restrictions.\n* Enable remote connection to your box: Control Panel > System > Advanced System Settings > Remote > Allow remote connections to this computer.\n* Turn off Windows Update: Control Panel > System > Turn automatic updating on or off > Never check for updates\n* The Advanced tab > Performance Settings, tweak visual effects to performance, then further on the Advanced tab limit the maximum virtual memory paging file size to 1024 MB. Restart if prompted.\n* Finally, use disk clean to reduce the box size\n\n## Exporting Your VirtualBox Virtual Machine as Base Box\n\n    vagrant package --base <Name of the VM in the Virtualbox GUI> --output /path/to/output/Windows7.box\n\n## Exporting Your VMWare Virtual Machine as Base Box\n\nVagrant also support to create boxes for VMware provider. You will need to first install the Vagrant VMware support following this [guide](https://www.vagrantup.com/docs/providers/vmware/installation). Create a `metadata.json` file inside **vmwarevm** folder with following content.\n\n    {\n        \"provider\": \"vmware_desktop\"\n    }\n\nRemove any extraneous files from the **vmwarevm** folder and package it. Prior to packaging up a box, we should shrink the hard drives as much as possible. This can be done with\n\n    vmware-vdiskmanager -d /path/to/vmwarevm/main.vmdk\n    vmware-vdiskmanager -k /path/to/vmwarevm/main.vmdk\n    cd /path/to/vmwarevm\n    tar cvzf /path/to/output/Windows7.box ./*\n\n## Test Your Base Box Locally\n\n    vagrant box add /path/to/output/Windows7.box --name Windows7\n    vagrant init Windows7\n    vagrant up --provider=vmware_desktop\n\n## Publish Your Base Box\n\nOpen https://app.vagrantup.com/boxes/new and follow the instruction to create a Box. Once the Box is created, select `Add a provider`, and then choose corresponding provider and upload the box file. You can also use [my box distribution](https://app.vagrantup.com/vitamina/boxes/Windows7).\n\n## Use Your Base Box\n\nYou can use `vagrant up` command with the `--provider` flag to specify the provider you want to use and then specify the base box distribution with `config.vm.box = \"vitamina/Windows7\"`.\n\n## Reference\n\n* [Creating a Windows 10 Base Box for Vagrant with VirtualBox](https://huestones.co.uk/2015/08/creating-a-windows-10-base-box-for-vagrant-with-virtualbox/)\n* [Vagrant: Creating a Base Box](https://www.vagrantup.com/docs/providers/virtualbox/boxes)\n* [Vagrant: CLI package command](https://www.vagrantup.com/docs/cli/package)\n* [Vagrant: Creating a New Vagrant Box](https://www.vagrantup.com/vagrant-cloud/boxes/create)\n* [Vagrant Windows Machine](https://github.com/fabiohbarbosa/vagrant-windows7)\n* [In search of a lightweight windows vagrant box](http://www.hurryupandwait.io/blog/in-search-of-a-light-weight-windows-vagrant-box)\n* [Vagrant Box for Windows 10](https://github.com/jeffskinnerbox/Windows-10-Vagrant-Box)\n* [Vagrant Windows 7 Machine](https://github.com/fabiohbarbosa/vagrant-windows7)\n* [Vagrant: Basic Provider Usage](https://www.vagrantup.com/docs/providers/basic_usage#default-provider)\n* [Vagrant: VMware Provider](https://www.vagrantup.com/docs/providers/vmware)\n* [Vagrant: Default Provider](https://www.vagrantup.com/docs/providers/default)\n* [Vagrant: Box File Format](https://www.vagrantup.com/docs/boxes/format)\n* [CREATE A WINDOWS 10 VAGRANT BOX](https://mesd.ag/windows-10-vagrant-box/)\n* [Create Windows 10 Vagrant Base Box](https://softwaretester.info/create-windows-10-vagrant-base-box/)\n* [Reusable Windows VMs with Vagrant](https://dev.to/jeikabu/reusable-windows-vms-with-vagrant-2h5c)\n* [Creating a Windows Box with Vagrant 1.6](https://dennypc.wordpress.com/2014/06/09/creating-a-windows-box-with-vagrant-1-6/)\n"
    },
    "lang": "en",
    "_nextI18Next": {
      "initialI18nStore": {
        "en": {
          "common": { "Next": "Next" },
          "feature-tags": { "Tags": "Tags" },
          "navbar": {
            "Home": "Home",
            "Language": "Language",
            "Tags": "Tags",
            "en": "English",
            "es": "Spanish",
            "zh": "Chinese"
          },
          "post-layout": { "Author": "Author: {{author}}" }
        }
      },
      "initialLocale": "en",
      "ns": ["common", "feature-tags", "navbar", "post-layout"],
      "userConfig": {
        "i18n": { "defaultLocale": "en", "locales": ["en", "es", "zh"] },
        "default": {
          "i18n": { "defaultLocale": "en", "locales": ["en", "es", "zh"] }
        }
      }
    }
  },
  "__N_SSG": true
}
