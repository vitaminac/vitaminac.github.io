<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="content-language" content="en" />
    <link rel="icon" href="/favicon.ico" />
    <title>How to Create a Windows7 Vagrant Base Box</title>
    <meta name="og:title" content="How to Create a Windows7 Vagrant Base Box" />
    <meta name="author" content="Gao" />
    <meta name="keywords" content="Vagrant,winrm" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="next-head-count" content="10" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
      integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      integrity="sha512-c42qTSw/wPZ3/5LBzD+Bw5f7bSF2oxou6wEb+I/lqeaKV5FDIfMvvRp772y4jcJLKuGUOpbJMdg/BTl50fJYAw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"
      integrity="sha384-ZPe7yZ91iWxYumsBEOn7ieg8q/o+qh/hQpSaPow8T6BwALcXSCS6C6fSRPIAnTQs"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css"
      integrity="sha512-hasIneQUHlh06VNBe7f6ZcHmeRTLIaQWFd43YriJ0UND19bvYRauxthDg8E4eVNPm9bRUhr5JGeqH7FRFXQu5g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="preload"
      href="/_next/static/css/b03d983dbf205dad.css"
      as="style"
    />
    <link
      rel="stylesheet"
      href="/_next/static/css/b03d983dbf205dad.css"
      data-n-g=""
    />
    <link
      rel="preload"
      href="/_next/static/css/f2f580b8a013fccf.css"
      as="style"
    />
    <link
      rel="stylesheet"
      href="/_next/static/css/f2f580b8a013fccf.css"
      data-n-p=""
    />
    <noscript data-n-css=""></noscript>
    <script
      defer=""
      nomodule=""
      src="/_next/static/chunks/polyfills-42372ed130431b0a.js"
    ></script>
    <script
      src="/_next/static/chunks/webpack-b8f8d6679aaa5f42.js"
      defer=""
    ></script>
    <script
      src="/_next/static/chunks/framework-49c6cecf1f6d5795.js"
      defer=""
    ></script>
    <script
      src="/_next/static/chunks/main-78a206356629e049.js"
      defer=""
    ></script>
    <script
      src="/_next/static/chunks/pages/_app-4103696f59b676b9.js"
      defer=""
    ></script>
    <script
      src="/_next/static/chunks/470-88ca63604181d961.js"
      defer=""
    ></script>
    <script
      src="/_next/static/chunks/287-15331c4732f63f37.js"
      defer=""
    ></script>
    <script
      src="/_next/static/chunks/pages/posts/%5Bslug%5D-e7a2f8c290316fd0.js"
      defer=""
    ></script>
    <script src="/_next/static/fixed/_buildManifest.js" defer=""></script>
    <script src="/_next/static/fixed/_ssgManifest.js" defer=""></script>
  </head>
  <body>
    <div id="__next">
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
        crossorigin="anonymous"
      />
      <nav
        class="navbar navbar-expand-md navbar-light sticky-top NavigationBar_navBar__fSiIq tw-bg-white/95 tw-shadow tw-shadow-black/25"
      >
        <div class="container-fluid px-md-5">
          <div class="navbar-brand animate__animated animate__pulse">
            <span
              class="tw-rounded tw-bg-black tw-p-1 tw-text-xl tw-font-medium tw-text-white"
              >Gao&#x27;s blog</span
            >
          </div>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="navbar-collapse collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mb-2 mb-lg-0 ms-auto">
              <li class="nav-item">
                <a
                  class="nav-link active"
                  aria-current="page"
                  href="/posts/langs/en/"
                  >Home</a
                >
              </li>
              <li class="nav-item">
                <a
                  class="nav-link"
                  aria-current="page"
                  href="/posts/langs/en/tags/"
                  >Tags</a
                >
              </li>
              <li class="nav-item dropdown">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  >Language</a
                >
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="/posts/langs/en/">English</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="/posts/langs/es/">Spanish</a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="/posts/langs/zh/">Chinese</a>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <header
        class="tw-flex tw-h-96 tw-w-screen tw-flex-col tw-content-center tw-justify-center tw-bg-cover tw-bg-center tw-bg-no-repeat tw-text-center tw-text-white"
        style="
          background-image: url(/_next/static/media/default-post-preview.c96b099a.jpeg);
        "
      >
        <h1>How to Create a Windows7 Vagrant Base Box</h1>
        <p>Author: Gao</p>
        <span
          ><i class="fa-regular fa-calendar"></i
          ><time class="tw-pl-1.5" datetime="2022-03-26 11:55:38"
            >March 26, 2022</time
          ></span
        >
        <section class="tw-mt-3 tw-text-center">
          <p>Tags<!-- -->:</p>
          <ul class="tw-p-0">
            <li class="tw-inline tw-px-1">
              <a
                class="PostTags_tag__3LUVs tw-border-white tw-text-white"
                href="/posts/langs/en/tags/Vagrant/"
                >Vagrant</a
              >
            </li>
            <li class="tw-inline tw-px-1">
              <a
                class="PostTags_tag__3LUVs tw-border-white tw-text-white"
                href="/posts/langs/en/tags/winrm/"
                >winrm</a
              >
            </li>
          </ul>
        </section>
      </header>
      <div class="tw-mx-auto tw-w-11/12">
        <main>
          <article>
            <iframe
              title="Windows7-Vagrant"
              src="/Windows7-Vagrant/index.html"
              width="100%"
              height="0px"
            ></iframe>
          </article>
        </main>
        <aside></aside>
      </div>
      <footer class="tw-text-center tw-text-gray-400">
        <div class="row justify-content-center">
          <ul class="list-inline text-center tw-text-stone-700">
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://www.linkedin.com/in/shuxig"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i
                    class="fab fa-linkedin-in fa-stack-1x fa-inverse"
                  ></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="mailto:dalao1002@gmail.com?subject=From my blog&amp;body=Hi,I found this website very useful"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i class="fas fa-envelope fa-stack-1x fa-inverse"></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://github.com/vitaminac"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i class="fab fa-github fa-stack-1x fa-inverse"></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://gist.github.com/vitaminac"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i
                    class="fab fa-github-square fa-stack-1x fa-inverse"
                  ></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://gitlab.com/vitaminac"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i class="fab fa-gitlab fa-stack-1x fa-inverse"></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://www.kaggle.com/dalao1002"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i class="fab fa-kaggle fa-stack-1x fa-inverse"></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://leetcode.com/dalao1002"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i class="fas fa-code fa-stack-1x fa-inverse"></i></span
              ></a>
            </li>
            <li class="list-inline-item">
              <a
                class="tw-text-stone-700"
                target="_blank"
                href="https://stackoverflow.com/users/9980245"
                ><span class="fa-stack fa-lg"
                  ><i class="fa fa-circle fa-stack-2x"></i
                  ><i
                    class="fab fa-stack-overflow fa-stack-1x fa-inverse"
                  ></i></span
              ></a>
            </li>
          </ul>
        </div>
        <img
          alt="QR"
          loading="lazy"
          width="1710"
          height="624"
          decoding="async"
          data-nimg="1"
          class="tw-mx-auto tw-max-w-full tw-object-contain tw-object-center lg:tw-max-w-xl"
          style="
            color: transparent;
            background-size: cover;
            background-position: 50% 50%;
            background-repeat: no-repeat;
            background-image: url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 120&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAIAAAAhqtkfAAAAVklEQVR42gFLALT/AKrStMHRxZXRpW3NilHIekDGcw/CYyjCZwC/z8LTwcan0LKu37rI48+228C838WZ16oApdSxvdPCi86doNmvx+LNu9vDx+LOn9muCIkyTVum2sgAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;);
          "
          src="/_next/static/media/QR.b48259ea.png"
        />
        <p>Copyright © Gao&#x27;s blog 2024</p>
      </footer>
    </div>
    <script id="__NEXT_DATA__" type="application/json">
      {
        "props": {
          "pageProps": {
            "postData": {
              "title": "How to Create a Windows7 Vagrant Base Box",
              "markdownContentSource": "\n# How to Create a Windows 7 Vagrant Base Box?\n\n## Introduction\n\nSince Vagrant 1.6 release, Vagrant add support for Windows VMs. We will go through the steps to follow to create a Windows 7 Vagrant base box.\n\n## Pre-requisites\n\n* VirtualBox/VMWare\n* Vagrant 1.6 or above\n* Windows 7 ISO file\n* VirtualBox Guest Additions\n* A valid license key for the version of Windows 7 to be installed\n\n## Create New Virtual Machine\n\nStart VirtualBox and create a new Windows 7 virtual machine. Name it whatever you like, though keep it simple as we will override this name later in Vagrantfile. We will follow most of the advice given in the Vagrant documentation regarding base boxes.\n\n* Disk Space: Choose a virtual hard disk (VDI) dynamically allocated and choose a high upper limit for the size. The default max-size is pretty low (32 GB).\n* Memory: Choose a low value here e.g. 1 GB, the reason is users that use the base box can always increase the memory in their Vagrantfile. I chose 2048 MB, but 1024 MB would do as well.\n* CPU: Leave this at the default of 1. Again this is something users can override in the Vagrantfile, so try not to require a higher number to start with.\n* Disable any unnecessary hardware like audio. Leave 2D/3D acceleration disabled.\n\nThe idea behind these choices is to create your base box as light on resources as possible with as much room as possible for later customization. When creating a new machine in VirtualBox in the wizard a lot of options are auto-configured, so we may need to edit the machine after it is created, going into Settings, to change some options.\n\n* Settings \u003e General \u003e Advanced: Enable Host-to-Guest shared clipboard.\n* Settings \u003e General \u003e System \u003e Motherboard: Disable Floppy boot.\n* Settings \u003e General \u003e Audio: Disable audio.\n\nYou can follow the New Virtual Machine Wizard with Custom (advanced) configuration to create the Windows 7 virtual machine. Select similar options as VirtualBox, although some options might be different.\n\n* Select the version of Windows to install\n* Full name: vagrant\n* Password: vagrant\n* Firmware type: BIOS\n* Network connection: NAT\n* Disk: Store virtual disk as a single file\n\nUsers of your base box can always modify these options in their Vagrantfile, using the [VirtualBox specific configuration](https://www.vagrantup.com/docs/providers/virtualbox/configuration) or [VMWare specific configuration](https://www.vagrantup.com/docs/providers/vmware/configuration).\n\n## Install Windows 7\n\nYou should have your Windows 10 ISO ready at hand, then configure the ISO file to boot from in VirtualBox, skip prompts to enter a license key and this can always be entered later through Control Panel or command line, after this, installation is straight forward.\n\nTowards the end of the installation you will be prompted to sign in your Microsoft account, again skip this. You want to create a local admin account on your clean install named vagrant with password also vagrant. This is required if you want Vagrant to automatically connect to and provision machines on your base box.\n\nLet the Windows setup complete, you will be presented with a login prompt for your user vagrant. Go ahead and login to the Windows 10 desktop. When connecting to the network windows will ask you if the network you are connected to is public or private. Choose private, otherwise you will get issues with **WinRM** in the next step.\n\n## Prepare Windows For Vagrant\n\n* Install VirtualBox Guest Additions/VMware Tools on your base box from the menu.\n* Control Panel \u003e Programs and Features \u003e Turn Windows features on or off.\n* Disable UAC: Control Panel \u003e User Accounts \u003e Change user account control settings, drop the slider to the bottom - Never notify.\n* Turn off System Protection： Control Panel \u003e System \u003e Advanced System Settings \u003e System Protection \u003e Turn off protection.\n* Enable **WinRM** service：Open command prompt as Administrator and paste each line and press enter. The last line configures **WinRM** services to start automatically. This will allow Vagrant to connect to the box and control it. **WinRM** is the alternative to ssh for windows boxes.\n----\n\n    winrm quickconfig -q\n    winrm set winrm/config/winrs @{MaxMemoryPerShellMB=\"512\"}\n    winrm set winrm/config @{MaxTimeoutms=\"1800000\"}\n    winrm set winrm/config/service @{AllowUnencrypted=\"true\"}\n    winrm set winrm/config/service/auth @{Basic=\"true\"}\n    sc config WinRM start= auto\n\n* Relax the Powershell execution policy: Run Powershell as Administrator and execute this command: `Set-ExecutionPolicy -ExecutionPolicy Unrestricted`, choose Yes to any prompts. This will allow Powershell scripts to provision your base box without annoying restrictions.\n* Enable remote connection to your box: Control Panel \u003e System \u003e Advanced System Settings \u003e Remote \u003e Allow remote connections to this computer.\n* Turn off Windows Update: Control Panel \u003e System \u003e Turn automatic updating on or off \u003e Never check for updates\n* The Advanced tab \u003e Performance Settings, tweak visual effects to performance, then further on the Advanced tab limit the maximum virtual memory paging file size to 1024 MB. Restart if prompted.\n* Finally, use disk clean to reduce the box size\n\n## Exporting Your VirtualBox Virtual Machine as Base Box\n\n    vagrant package --base \u003cName of the VM in the Virtualbox GUI\u003e --output /path/to/output/Windows7.box\n\n## Exporting Your VMWare Virtual Machine as Base Box\n\nVagrant also support to create boxes for VMware provider. You will need to first install the Vagrant VMware support following this [guide](https://www.vagrantup.com/docs/providers/vmware/installation). Create a `metadata.json` file inside **vmwarevm** folder with following content.\n\n    {\n        \"provider\": \"vmware_desktop\"\n    }\n\nRemove any extraneous files from the **vmwarevm** folder and package it. Prior to packaging up a box, we should shrink the hard drives as much as possible. This can be done with\n\n    vmware-vdiskmanager -d /path/to/vmwarevm/main.vmdk\n    vmware-vdiskmanager -k /path/to/vmwarevm/main.vmdk\n    cd /path/to/vmwarevm\n    tar cvzf /path/to/output/Windows7.box ./*\n\n## Test Your Base Box Locally\n\n    vagrant box add /path/to/output/Windows7.box --name Windows7\n    vagrant init Windows7\n    vagrant up --provider=vmware_desktop\n\n## Publish Your Base Box\n\nOpen https://app.vagrantup.com/boxes/new and follow the instruction to create a Box. Once the Box is created, select `Add a provider`, and then choose corresponding provider and upload the box file. You can also use [my box distribution](https://app.vagrantup.com/vitamina/boxes/Windows7).\n\n## Use Your Base Box\n\nYou can use `vagrant up` command with the `--provider` flag to specify the provider you want to use and then specify the base box distribution with `config.vm.box = \"vitamina/Windows7\"`.\n\n## Reference\n\n* [Creating a Windows 10 Base Box for Vagrant with VirtualBox](https://huestones.co.uk/2015/08/creating-a-windows-10-base-box-for-vagrant-with-virtualbox/)\n* [Vagrant: Creating a Base Box](https://www.vagrantup.com/docs/providers/virtualbox/boxes)\n* [Vagrant: CLI package command](https://www.vagrantup.com/docs/cli/package)\n* [Vagrant: Creating a New Vagrant Box](https://www.vagrantup.com/vagrant-cloud/boxes/create)\n* [Vagrant Windows Machine](https://github.com/fabiohbarbosa/vagrant-windows7)\n* [In search of a lightweight windows vagrant box](http://www.hurryupandwait.io/blog/in-search-of-a-light-weight-windows-vagrant-box)\n* [Vagrant Box for Windows 10](https://github.com/jeffskinnerbox/Windows-10-Vagrant-Box)\n* [Vagrant Windows 7 Machine](https://github.com/fabiohbarbosa/vagrant-windows7)\n* [Vagrant: Basic Provider Usage](https://www.vagrantup.com/docs/providers/basic_usage#default-provider)\n* [Vagrant: VMware Provider](https://www.vagrantup.com/docs/providers/vmware)\n* [Vagrant: Default Provider](https://www.vagrantup.com/docs/providers/default)\n* [Vagrant: Box File Format](https://www.vagrantup.com/docs/boxes/format)\n* [CREATE A WINDOWS 10 VAGRANT BOX](https://mesd.ag/windows-10-vagrant-box/)\n* [Create Windows 10 Vagrant Base Box](https://softwaretester.info/create-windows-10-vagrant-base-box/)\n* [Reusable Windows VMs with Vagrant](https://dev.to/jeikabu/reusable-windows-vms-with-vagrant-2h5c)\n* [Creating a Windows Box with Vagrant 1.6](https://dennypc.wordpress.com/2014/06/09/creating-a-windows-box-with-vagrant-1-6/)\n",
              "slug": "Windows7-Vagrant",
              "date": "2022-03-26 11:55:38",
              "lang": "en",
              "tags": ["Vagrant", "winrm"],
              "path": "/Windows7-Vagrant/index.html"
            },
            "lang": "en",
            "_nextI18Next": {
              "initialI18nStore": {
                "en": {
                  "navbar": {
                    "Home": "Home",
                    "Language": "Language",
                    "Tags": "Tags",
                    "en": "English",
                    "es": "Spanish",
                    "zh": "Chinese"
                  },
                  "post-layout": {
                    "Author": "Author: {{author}}",
                    "Tags": "Tags"
                  }
                }
              },
              "initialLocale": "en",
              "ns": ["navbar", "post-layout"],
              "userConfig": {
                "i18n": {
                  "defaultLocale": "en",
                  "locales": ["en", "es", "zh"]
                },
                "default": {
                  "i18n": {
                    "defaultLocale": "en",
                    "locales": ["en", "es", "zh"]
                  }
                }
              }
            }
          },
          "__N_SSG": true
        },
        "page": "/posts/[slug]",
        "query": { "slug": "Windows7-Vagrant" },
        "buildId": "fixed",
        "isFallback": false,
        "gsp": true,
        "scriptLoader": []
      }
    </script>
  </body>
</html>
